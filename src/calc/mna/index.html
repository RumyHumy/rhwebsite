<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="/styles.css" rel="stylesheet"/>
		<script src="/scripts/page.js"></script>
	</head>
	<body>
		<h1 id="page-header">
			<a href="/" style="color: unset; text-decoration: none;">
				<span class="lang-en">RumyHumy</span>
				<span class="lang-ru">РумуХуму</span>
			</a>
		</h1>
		<div class="page-spotlight">
			<div class="page-content">
				<span class="title-en">RH: MNA</span>
<span class="title-ru">РХ: МУП</span>

<h1>
	<span class="lang-en">MNA (Modified Nodal Analysis)</span>
	<span class="lang-ru">МУП (Метод Узловых Потенциалов)</span>
</h1>

<hr>

<style>
#calc-field em {
	color: var(--col-sp);
	font-weight: bold;
}
</style>

<div id="calc-field">
	<p>
		<span class="lang-en">Enter circuit information in this format <i>[node1] [node2] [type_name] [value]</i> for each element separated by ",".</span>
		<span class="lang-ru">Введите цепь в формате <i>[узел1] [узел2] [тип_название1] [значение]</i> для каждого элемента через ",".</span>
	</p>
	<p>
		<span class="lang-en">Circuit</span>
		<span class="lang-ru">Цепь</span>
		<textarea id="circ-text" >1 2 u0 3, 2 3 r1 2, 3 1 i2 2, 3 1 r3 1</textarea><br>
	</p>
	<p>
		<button id="calc" style="margin: auto;">
			<span class="lang-en">Let's go</span>
			<span class="lang-ru">Погнали</span>
		</button>
	</p>
	<p id="error-messages">
		<em id="emsg-args" style="display: none;">
			<span class="lang-en">{0} arguments for element {1} (expected 4).</span>
			<span class="lang-ru">{0} аргумент(ов) для элемента {1} (ожидалось 4).</span>
		</em>
		<em id="emsg-value-parsing" style="display: none;">
			<span class="lang-en">Cannot read value for element {0} ({1})?"</span>
			<span class="lang-ru">Невозможно прочитать значение элемента {0} ({1})?</span>
		</em>
		<em id="emsg-unique" style="display: none;">
			<span class="lang-en">Name for element {0}{1} is not unique</span>
			<span class="lang-ru">Имя для элемента {0}{1} не уникально</span>
		</em>
	</p>
	<hr>
	<p>
	</p>
</div>

<script src="/scripts/mathjs/math.js"></script>
<script>
	var calcButton = document.getElementById("calc");
	var circTextElement = document.getElementById("circ-text");
	var errorMessages = document.getElementById("error-messages");

	function CALC_ERROR(errorMsgId, args) {
		for (let i = 0; i < errorMessages.children.length; i++)
			errorMessages.children[i].style.display = 'none';
		var el = document.getElementById(errorMsgId);
		el.style.display = 'inline';
		for (var i = 0; i < args.length; i++) {
			el.innerHTML = el.innerHTML.replace("{"+i+"}", args[i]);
		}
		console.log(el);
		return 1;
	}

	function LinearSolve(A, B) {
		try {
			return math.transpose(math.lusolve(math.matrix(A), math.matrix(B))).valueOf();
		} catch (error) {
			console.log(error);
		}
	}
	A = [[1, 2], [1, 0]];
	B = [-1, 2];
	alert(LinearSolve(A, B));

	calcButton.addEventListener('click', () => {
		var circText = circTextElement.value;
		circ = circText.split(',');
		var _nodeNames = [];
		var elNames = [];
		for (var i = 0; i < circ.length; i++) {
			// Disection
			circ[i] = circ[i].trim().split(' ');
			if (circ[i].length != 4)
				return CALC_ERROR("emsg-args", [circ[i].length, i+1]);
			// Node names
			_nodeNames.push(circ[i][0]);
			_nodeNames.push(circ[i][1]);
			// Element names
			elNames.push(circ[i][2].substring(1));
			circ[i][2] = circ[i][2][0];
			// Value check
			const eVal = parseFloat(circ[i][3]);
			if (isNaN(eVal))
				return CALC_ERROR("emsg-value-parsing", [i+1, circ[i][3]]);
			circ[i][3] = eVal;

		}
		// Unique name check
		for (var i = 0; i < elNames.length; i++) {
			if (elNames.lastIndexOf(elNames[i]) != i)
				return CALC_ERROR("emsg-unique", [circ[i][2], elNames[i]]);
		}
		// Node indexes in circ array
		_nodeNames.sort();
		var nodeNames = [];
		for (var i = 0; i < _nodeNames.length; i++) {
			if (i == _nodeNames.length-1 || _nodeNames[i] != _nodeNames[i+1])
				nodeNames.push(_nodeNames[i]);
		}
		for (var i = 0; i < circ.length; i++) {
			circ[i][0] = nodeNames.indexOf(circ[i][0]);
			circ[i][1] = nodeNames.indexOf(circ[i][1]);
		}
		//
	});
	const beforeUnloadHandler = (event) => {
		event.preventDefault();
		event.returnValue = true;
	};
	window.addEventListener("beforeunload", beforeUnloadHandler);
</script>
			</div>
		</div>
		<div id="page-footer">
	<span class="lang-en">
		© 2025 • Ramil Khasanshin |
		<a href='#' onclick='localStorage.setItem("lang", "ru"); SetLang(); return false;'>Русский</a>
	</span>
	<span class="lang-ru">
		© 2025 • Рамиль Хасаншин |
		<a href='#' onclick='localStorage.setItem("lang", "en"); SetLang(); return false;'>English</a>
	</span>
</div>
		<script> PageUpdate(); </script>
	</body>
</htm